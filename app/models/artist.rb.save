class Artist < ApplicationRecord
  has_many :shows, dependent: :destroy
  # TODO: get default scope as name (ignore case) (sql command)
  default_scope -> { order(name: :asc) }
  validates :name, presence: true, length: { maximum: 100 }
  validates :name, uniqueness: { case_sensitive: false }

  class << self
    def artist_csv
      csv_text = File.read('app/assets/csv/artists.csv')
      csv = CSV.parse(csv_text, headers: true)
      csv['Artist']
    end

    def show_deal_ids
      #  deal_ids = Shows.where(artist: self.name)
      # replace with
      deal_ids = Show.where('artist = ?', name)
    end

    # Search by an artist name.
   def search(search)
      Artist.where('name like ?', "%#{search}%")
    end
  end
end
